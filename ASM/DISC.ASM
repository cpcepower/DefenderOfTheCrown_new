;*******************************************************************************;DISC.ASM                                                                      *;   Lectures disque pour DEFENDER OF THE CROWN                                 *;        (c)1988 B.RIVE                                                        *;*******************************************************************************;READFILE - Lecture d'un fichier;   ENTRY - HL-> Adresse du nom sur 12 octets.;           DE-> Adresse d'implantation.;   EXIT  - BC-> Nombre d'octets lus.;           DE-> Adresse premier octet suivant le fichier lu.;           MODIFIES- BC,DE,AF,HL;*******************************************************************************;RUNFILE  - Lecture et execution d'un fichier;   ENTRY - HL-> Adresse du nom sur 12 octets.;*******************************************************************************;;RUNFILE         LD   (REGBUF),DE         EX   (SP),HL         LD   E,(HL)         INC  HL         LD   D,(HL)         INC  HL         EX   (SP),HL         EX   DE,HL         PUSH BC         PUSH AF         PUSH DE         LD   DE,BUFOVL         CALL READFIL2         POP  HL         POP  AF         POP  BCREGBUF equ $ +1         LD   DE,0         JP   BUFOVLREADFILE         LD   BC,BUFFER_DATA         LD   (SAVEBUF),BCREADFIL2	ld a,(AMSDOS_current_drive)	ld (AMSDOS_current_drive_change_test),a	LD   A,(HL)         LD   (SIDESTR),A         INC  HL         PUSH IX         PUSH IY         LD   (DEFRDF10+1),HL	ld hl,drive_a_defender_side	cp (hl)	jr z,z_drive_a_defender_side	ld (update_drive_defender_side),hl	ld hl,drive_b_defender_side	cp (hl)	jr z,z_drive_b_defender_side	ld (update_drive_defender_side),hl	ld hl,AMSDOS_current_drive	ld (hl),&00	jr DEFRDF10DEFRDFI0	call &bc7d	call &bb54	ld a,(AMSDOS_current_drive)	xor 1	ld (AMSDOS_current_drive),aAMSDOS_current_drive_change_test        equ $+1	cp 0	jr nz,DEFRDF10	CALL DEFERRz_drive_a_defender_sidez_drive_b_defender_sideDEFRDF10 LD   HL,0;LOAD_FILE; ---------------------------; HL = FILENAME PTR; DE = BUFFER ADDRESS; ---------------------------	ld b,12	push de	call &bb57	call &bc77	pop de	jr nc,DEFRDFI0	ld h,d	ld l,e	add hl,bc	ld (nextadd),hl	ex de,hl	call &bc83;	jr nc,erreur_load	call &bc7a	jr nc,DEFRDFI0	call &bb54update_drive_defender_side equ $ +1	ld hl,0	ld a,(SIDESTR)	ld (hl),aNEXTADD equ $ +1	ld de,0         POP  IY         POP  IX         RETDEFERR         PUSH HL         PUSH IX         PUSH AF         PUSH BC         PUSH DE         LD   HL,#0B18	call SCR_CHAR_POSITION         PUSH HL         LD   C,8         LD   DE,#C7D0DEFERR2  PUSH BC         PUSH HL         LD   BC,#30         LDIR         LD   HL,#7D0         ADD  HL,DE         EX   DE,HL         POP  HL         CALL NEXTLINE         POP  BC         DEC  C         JR   NZ,DEFERR2         LD   HL,#0C19         CALL TXT_SET_CURSOR         LD   HL,ERRTEXT         LD   B,17DEFERR1  LD   A,(HL)         CALL TXT_OUTPUT         INC  HL         DJNZ DEFERR1         LD   A,7               ; BEEP         CALL TXT_OUTPUTDEFERR0  CALL GETJOY         JR   NC,DEFERR0         POP  HL         LD   C,8         LD   DE,#C7D0DEFERR3  PUSH BC         PUSH HL         LD   BC,#30         EX   DE,HL         LDIR         EX   DE,HL         LD   HL,#7D0         ADD  HL,DE         EX   DE,HL         POP  HL         CALL NEXTLINE         POP  BC         DEC  C         JR   NZ,DEFERR3         POP  DE         POP  BC         POP  AF         POP  IX         POP  HL         RET;ERRTEXT  DEFB "Ins[rez la face "SIDESTR  DEFB "A"drive_a_defender_side	db "0"drive_b_defender_side	db "0";;RESBUF   EQU  TAMPON         ;7;